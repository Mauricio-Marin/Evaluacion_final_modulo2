--TABLA CLIENTE
CREATE TABLE CLIENTE (
RUTCLIENTE NUMBER(9) NOT NULL,
   CLINOMBRES VARCHAR2(30) NOT NULL,
   CLIAPELLIDOS VARCHAR2(50) NOT NULL,
   CLITELEFONO VARCHAR2(20) NOT NULL,
   CLIAFP VARCHAR2(30),
   CLISISTEMASALUD NUMBER(2),
   CLIDIRECCION VARCHAR2(100) NOT NULL,
   CLICOMUNA VARCHAR2(50) NOT NULL,
   CLIEDAD NUMBER(3) NOT NULL,
   CONSTRAINT CLIENTE_PK PRIMARY KEY(RUTCLIENTE));



-- TABLA accidente
CREATE TABLE Accidente(
   idaccidente NUMBER(9)  CONSTRAINT accidente_pk PRIMARY KEY,
   accifecha DATE NOT NULL,
   accihora DATE NOT NULL,
    accilugar VARCHAR2(150)  NOT NULL,
    acciorigen VARCHAR2(100)NOT NULL,
	acciconsecuencias VARCHAR2(100),
    Cliente_rutcliente NUMBER(9)NOT NULL
    );

----------- LLAVE FORANEA accidente -----------	
	
ALTER TABLE accidente ADD CONSTRAINT ACCIDENTE_CLIENTE_FK
FOREIGN KEY (Cliente_rutcliente)
REFERENCES cliente (rutcliente);


-- TABLA visita
CREATE TABLE Visita(
   idvisita NUMBER(9)  CONSTRAINT visita_pk PRIMARY KEY,
   visfecha DATE NOT NULL,
   vishora DATE,
   vislugar VARCHAR2(50) NOT NULL,
   viscomentarios VARCHAR2(250)NOT NULL,
   Cliente_rutcliente NUMBER(9)NOT NULL
    );
	
----------- LLAVE FORANEA visita -----------	

ALTER TABLE visita ADD CONSTRAINT VISITA_CLIENTE_FK
FOREIGN KEY (Cliente_rutcliente)
REFERENCES cliente (rutcliente);


-- TABLA capacitacion
CREATE TABLE capacitacion(
   idcapacitacion NUMBER(9)  CONSTRAINT capacitacion_pk PRIMARY KEY,
   capfecha DATE NOT NULL,
   caphora DATE,   
   caplugar VARCHAR2(100) NOT NULL,
	capduracion NUMBER(4),
   Cliente_rutcliente NUMBER(9)NOT NULL
    );
----------- LLAVE FORANEA capacitacion -----------

ALTER TABLE capacitacion ADD CONSTRAINT CAPACITACION_CLIENTE_FK
FOREIGN KEY (Cliente_rutcliente)
REFERENCES cliente (rutcliente);


--TABLA ASISTENTES
CREATE TABLE ASISTENTES(
IDASISTENTE NUMBER(9) NOT NULL,
ASISTNOMBRECOMPLETO VARCHAR2(100) NOT NULL,
ASISTEDAD NUMBER(3) NOT NULL,
ASISTCORREO VARCHAR2(70),
ASISTTELEFONO VARCHAR2(20),
CAPACITACION_IDCAPACITACION NUMBER(9) NOT NULL,
CONSTRAINT ASISTENTES_PK PRIMARY KEY (IDASISTENTE));

----------- LLAVE FORANEA ASISTENTES -----------

ALTER TABLE ASISTENTES
add constraint ASISTENTES_CAPACITACION_FK
foreign key("CAPACITACION_IDCAPACITACION")
references "CAPACITACION"("IDCAPACITACION");



----------- CREACION TABLA CHEQUEOS -----------

CREATE TABLE CHEQUEOS(
  IDCHEQUEO NUMBER (9) NOT NULL,
  NOMBRECHEQUEO VARCHAR2(50) NOT NULL,
  CONSTRAINT CHEQUEOS_PK PRIMARY KEY (IDCHEQUEO));

----------- CREACION TABLA REGISTRO CHEQUEO -----------

CREATE TABLE REGISTROCHEQUEO(
REGISTRO_IDCHEQUEO NUMBER (9) NOT NULL,
REGISTRO_IDVISITA NUMBER(9) NOT NULL,
CUMPLECHEQUEO VARCHAR2(2) NOT NULL,
OBSERVACIONES VARCHAR2(200),
CONSTRAINT REGISTROCHEQUEO_PK PRIMARY KEY (REGISTRO_IDCHEQUEO));

--CHECK DE CAMPO CUMPLECHEQUEO
ALTER TABLE REGISTROCHEQUEO
ADD CONSTRAINT "COMP" CHECK (CUMPLECHEQUEO='SI' OR CUMPLECHEQUEO='NO');

--LLAVES FORANEAS REGISTROCHEQUEO
ALTER TABLE REGISTROCHEQUEO
ADD CONSTRAINT REGIDCHEQUEO_FK
FOREIGN KEY (REGISTRO_IDCHEQUEO)
REFERENCES CHEQUEOS (IDCHEQUEO);

ALTER TABLE REGISTROCHEQUEO
ADD CONSTRAINT REGIDVISITA_FK
FOREIGN KEY (REGISTRO_IDVISITA)
REFERENCES VISITA (IDVISITA);


----------- CREACION TABLA USUARIOS -----------
CREATE TABLE USUARIOS 
(IDUSUARIO NUMBER(9) CONSTRAINT usuarios_pk PRIMARY KEY,
NOMBREUSER VARCHAR2(100) NOT NULL,
APELLIDOUSER VARCHAR2(100) NOT NULL,
FECHANACIMIENTO DATE,
RUN NUMBER(9) NOT NULL
);

----------- MODIFICACION TABLA CLIENTE -----------
ALTER TABLE cliente ADD CLIENTE_IDUSUARIO NUMBER (9)NOT NULL;

--LLAVE FORANEA CLIENTE
ALTER TABLE CLIENTE ADD CONSTRAINT fk_CLIENTE
FOREIGN KEY (CLIENTE_IDUSUARIO)
REFERENCES USUARIOS (IDUSUARIO);


----------- CREACION TABLA PROFESIONAL -----------
CREATE TABLE PROFESIONAL
(PROFESIONAL_IDUSUARIO NUMBER(9) CONSTRAINT PROFESIONAL_pk PRIMARY KEY,
TELEFONO NUMBER(12),
TITULO VARCHAR2(50) NOT NULL,
PROYECTO VARCHAR2(70)NOT NULL
);

--LLAVE FORANEA PROFESIONAL
ALTER TABLE PROFESIONAL ADD CONSTRAINT fk_PROFESIONAL
FOREIGN KEY (PROFESIONAL_IDUSUARIO)
REFERENCES USUARIOS (IDUSUARIO);


----------- CREACION TABLA ADMINISTRATIVO -----------

CREATE TABLE ADMINISTRATIVO(
ADMINISTRATIVO_IDUSUARIO NUMBER(9) CONSTRAINT ADMINISTRATIVO_PK PRIMARY KEY,
CORREO VARCHAR2(25)NOT NULL,
AREA VARCHAR2(20)NOT NULL
);

--LLAVE FORANEA ADMINISTRATIVO
ALTER TABLE ADMINISTRATIVO ADD CONSTRAINT ADMINISTRATIVO_FK 
FOREIGN KEY (ADMINISTRATIVO_IDUSUARIO)
REFERENCES USUARIOS(IDUSUARIO);


----------- CREACION TABLA REGISTROPAGOS ----------

CREATE TABLE REGISTROPAGOS(
IDENTIFICADOR NUMBER(9) CONSTRAINT REGISTROPAGOS_pk PRIMARY KEY,
FECHAPAGO DATE NOT NULL,
MONTOPAGO NUMBER(20) NOT NULL,
MESREALIZAPAGO VARCHAR2(15)NOT NULL,
AÑOREALIZAPAGO VARCHAR2(5) NOT NULL,
CLIENTE_RUTCLIENTE NUMBER(9) NOT NULL
);

--LLAVE FORANEA REGISTROPAGOS
ALTER TABLE REGISTROPAGOS ADD CONSTRAINT fk_REGISTROPAGOS
FOREIGN KEY (CLIENTE_RUTCLIENTE)
REFERENCES CLIENTE(RUTCLIENTE);

--AUTO INCREMENTO IDENTIFICADOR DE REGISTROPAGOS 
CREATE SEQUENCE SEQ_IDENTIFICADOR;
 INCREMENT BY 1
  START WITH 1
  MAXVALUE 999999999999999999999999999
  MINVALUE 1
  CACHE 20;
  
CREATE OR REPLACE TRIGGER TRIG_IDENTIFICADOR
BEFORE INSERT ON REGISTROPAGOS
FOR EACH ROW
WHEN(NEW.IDENTIFICADOR IS NULL)
BEGIN
SELECT SEQ_IDENTIFICADOR.NEXTVAL
INTO :NEW.IDENTIFICADOR
FROM DUAL;
END;



----------- CREACION TABLA AESESORIAS----------


CREATE TABLE ASESORIAS (
  IDASESORIAS NUMBER(9) NOT NULL,
  FECHA DATE NOT NULL,
  MOTIVO VARCHAR2(20) NOT NULL,
  PROFESIONAL NUMBER(9) NOT NULL,
  CONSTRAINT ASESORIAS_PK PRIMARY KEY (IDASESORIAS));
  
  
 ---------LLAVE FORANEA------------- 
  alter table ASESORIAS
  add constraint ASESORIAS_PROFESIONAL_FK
  foreign key(PROFESIONAL)
  references PROFESIONAL(PROFESIONAL_IDUSUARIO);
  
  
----------- CREACION TABLA MEJORAS-----
  
  CREATE TABLE MEJORAS(
  IDMEJORA NUMBER (9) NOT NULL,
  TITULO VARCHAR2(20) NOT NULL,
  DESCRIPCION VARCHAR2(200),
  PLAZORESOLUCION NUMBER NOT NULL,
  MEJORAS_IDASESORIAS NUMBER(9) NOT NULL,
  CONSTRAINT MEJORAS_PK PRIMARY KEY(IDMEJORA));
  
  ---------LLAVE FORANEA------------- 
  alter table MEJORAS
  add constraint MEJORAS_ASESORIAS_FK
  foreign key(MEJORAS_IDASESORIAS)
  references ASESORIAS(IDASESORIAS);
  
  ------SECUENCIA PARA MEJORAS--------
  
  CREATE SEQUENCE SEQ_MEJORA
  INCREMENT BY 1
  START WITH 1
  MAXVALUE 999999999999999999999999999
  MINVALUE 1
  CACHE 20;
  
  ------DISPARADOR PARA MEJORAS--------
  
  CREATE OR REPLACE TRIGGER TRIG_MEJORAS
BEFORE INSERT ON MEJORAS
FOR EACH ROW
WHEN(NEW.IDMEJORA IS NULL)
BEGIN
SELECT SEQ_MEJORA.NEXTVAL
INTO :NEW.IDMEJORA
FROM DUAL;
END;

--------------------------------------------------------------------------
-----INSERCION DE DATOS EN TABLAS---
--TABLA USUARIOS

INSERT INTO USUARIOS VALUES (1,'MARCELO', 'MARTINEZ', TO_DATE('10-11-1980','DD-MM-YYYY'), 25999666);
INSERT INTO USUARIOS VALUES (2, 'ALEXANDER', 'PEREZ', TO_DATE('30-09-1999','DD-MM-YYYY'), 22000999);
INSERT INTO USUARIOS VALUES (3, 'MARGARITA', 'MENESES', TO_DATE('30-08-1980','DD-MM-YYYY'), 10999888);
INSERT INTO USUARIOS VALUES (4, 'MOISES', 'LOPEZ', TO_DATE('21-09-1995','DD-MM-YYYY'), 12366222);
INSERT INTO USUARIOS VALUES (5, 'RUBEN', 'CARRASCO', TO_DATE('22-10-1996','DD-MM-YYYY'), 13555888);
INSERT INTO USUARIOS VALUES (6, 'GLORIA', 'DOOGLAS', TO_DATE('23-11-1997','DD-MM-YYYY'), 14444777);
INSERT INTO USUARIOS VALUES (7, 'JAIME', 'SOTO', TO_DATE('24-12-1998','DD-MM-YYYY'), 15999666);
INSERT INTO USUARIOS VALUES (8, 'FLOR', 'GONZALEZ', TO_DATE('25-01-1997','DD-MM-YYYY'), 16222333);
INSERT INTO USUARIOS VALUES (9, 'ROSA', 'ESPINOZA', TO_DATE('26-02-1996','DD-MM-YYYY'), 17999888);

--TABLA CLIENTE

INSERT INTO  CLIENTE VALUES (12334555, 'AGUSTIN SERAFIN', 'SERAFINI FILI', '33344455', 'CAPITALCA', 1, 'LOS ABEDULES #44', 'MACUL', 33,1);
INSERT INTO  CLIENTE VALUES (22334555, 'RAMON ARNOLDO', 'MARTINEZ LUENGO', '36667755', 'PROPROVIDA', 2, 'LOS ZORZALES #54', 'BUIN', 43,2);
INSERT INTO  CLIENTE VALUES (23555666, 'PAMELA ANDREA', 'FRITZ KKOPP', '5555455', 'MOMODELO', 1, 'LAS ACACIAS #784', 'VALPARAISO', 55,3);

--TABLA PROFESIONAL

INSERT INTO  PROFESIONAL VALUES (4, 33355544, 'ARQUITECTO', 'ARQUITECTURA EDIFICIO');
INSERT INTO  PROFESIONAL VALUES (5, 55556644, 'MEDICO', 'VACUNACION');
INSERT INTO  PROFESIONAL VALUES (6, 66776666, 'PERIODISTA', 'RELACIONES PUBLICAS');

--TABLA ADMINISTRATIVO

INSERT INTO  ADMINISTRATIVO VALUES (7, 'KERR@GMAIL.PK', 'OFICINAS');
INSERT INTO  ADMINISTRATIVO VALUES (8, 'POSTR@GMAIL.PK', 'RRHH');
INSERT INTO  ADMINISTRATIVO VALUES (9, 'TREKOP@GMAIL.PK', 'RECEPCION');


--TABLA ACCIDENTE

INSERT INTO  ACCIDENTE VALUES (1, TO_DATE('10-10-2019','DD-MM-YYYY'),TO_DATE('12:00','HH24:MI'),'SALA DE MAQUINAS', 'MALA MANIPULACION', 'CORTE MANO IZQUIERDA', 12334555);
INSERT INTO  ACCIDENTE VALUES (2, TO_DATE('05-09-2019','DD-MM-YYYY'),TO_DATE('13:00','HH24:MI'),'RECEPCION', 'CAIDA ESCALERA', 'ESGUINCE PIE DERECHO', 22334555);
INSERT INTO  ACCIDENTE VALUES (3, TO_DATE('10-08-2019','DD-MM-YYYY'),TO_DATE('11:50','HH24:MI'),'CASINO', 'TALLARIN EN EL OJO', 'OJO IRRITADO', 23555666);

--TABLA VISITA

INSERT INTO  VISITA VALUES (1, TO_DATE('05-09-2020','DD-MM-YYYY'),TO_DATE('13:00','HH24:MI'), 'OFICINAS', 'CLIENTE CONFORME', 12334555);
INSERT INTO  VISITA VALUES (2, TO_DATE('10-10-2020','DD-MM-YYYY'),TO_DATE('11:00','HH24:MI'), 'OFICINAS', 'CLIENTE CON PROBLEMAS TECNICOS', 22334555);
INSERT INTO  VISITA VALUES (3, TO_DATE('10-09-2020','DD-MM-YYYY'),TO_DATE('10:50','HH24:MI'), 'OFICINAS', 'CLIENTE CON DUDAS SOBRE PRESUPUESTO', 23555666);

--TABLA CAPACITACION
    
INSERT INTO  CAPACITACION VALUES (1, TO_DATE('10-11-2020','DD-MM-YYYY'),TO_DATE('12:00','HH24:MI'), 'OFICINA PRINCIPAL', 120, 12334555);
INSERT INTO  CAPACITACION VALUES (2, TO_DATE('12-12-2020','DD-MM-YYYY'),TO_DATE('10:00','HH24:MI'), 'SALA CAPACITACIONES', 60, 23555666);
INSERT INTO  CAPACITACION VALUES (3, TO_DATE('09-09-2020','DD-MM-YYYY'),TO_DATE('11:00','HH24:MI'), 'OFICINA PRINCIPAL', 70, 22334555);

--TABLA ASISTENTES

INSERT INTO  ASISTENTES VALUES (1, 'RAMON ARNOLDO MARTINEZ LUENGO', 43, 'RALUE@GMAIL.PK', '36667755', 3);
INSERT INTO  ASISTENTES VALUES (2, 'AGUSTIN SERAFIN SERAFINI FILI', 33, 'SERAFINI@GMAIL.PK', '33344455', 1);
INSERT INTO  ASISTENTES VALUES (3, 'PAMELA ANDREA FRITZ KKOPP', 55, 'KKOPP@GMAIL.PK', '5555455', 2);

--TABLA CHEQUEOS

INSERT INTO  CHEQUEOS VALUES (1, 'REVISION COMPUERTAS');
INSERT INTO  CHEQUEOS VALUES (2, 'REVISION ESTRUCTURA');
INSERT INTO  CHEQUEOS VALUES (3, 'REVISION SEGURIDAD');

--TABLA REGISTRO CHEQUEO

INSERT INTO  REGISTROCHEQUEO VALUES (1, 3, 'SI', 'SIN OBSERVACIONES');
INSERT INTO  REGISTROCHEQUEO VALUES (2, 2, 'SI', 'DETALLES MINIMOS');
INSERT INTO  REGISTROCHEQUEO VALUES (3, 1, 'NO', 'PROBLEMAS EN EQUIPAMIENTO');





--TABLA REGISTRO PAGOS IDENTIFICADOR EN BLANCO PARA QUE FUNCIONE AUTOINCREMENTO

INSERT INTO  REGISTROPAGOS VALUES ('', TO_DATE('11-11-2020','DD-MM-YYYY'), 220000, 'NOVIEMBRE', '2020', 22334555);
INSERT INTO  REGISTROPAGOS VALUES ('', TO_DATE('08-10-2020','DD-MM-YYYY'), 300000, 'OCTUBRE', '2020', 12334555);
INSERT INTO  REGISTROPAGOS VALUES ('', TO_DATE('11-10-2020','DD-MM-YYYY'), 500000, 'OCTUBRE', '2020', 23555666);

--TABLA ASESORIAS

INSERT INTO  ASESORIAS VALUES (1, TO_DATE('22-01-2012','DD-MM-YYYY'), 'BALANCE', 4);
INSERT INTO  ASESORIAS VALUES (2, TO_DATE('30-01-2010','DD-MM-YYYY'), 'AUDITORIA', 5);
INSERT INTO  ASESORIAS VALUES (3, TO_DATE('15-10-2020','DD-MM-YYYY'), 'ARQUEO CAJA', 6);

--TABLA MEJORAS SE DEJA EN BLANCO EL PRIMER VALOR IDMEJORA PARA QUE FUNCIONE EL AUTOINCREMENTO

INSERT INTO  MEJORAS VALUES('', 'ORDENAMIENTO','ORDENAMIENTO LIBROS CONTABLES', 3, 1);
INSERT INTO  MEJORAS VALUES('', 'REVISION','REVISION DE INFRAESTRUCTURA', 2, 2);
INSERT INTO  MEJORAS VALUES('', 'PLANIFICACION','PLANIFICACION DE REUNIONES SEMANALES', 5, 3);